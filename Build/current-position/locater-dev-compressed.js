(function(){var a=this.Locater={version:"1.0"}}());(function(c){var b=c.Rules={_rules:{},getRule:function(d){return this._rules[d]},getRules:function(){return this._rules},isDefined:function(d){return(this._rules[d])?true:false},define:function(d,e){if(!(Type.isFunction(e.invoke)||Type.isFunction(e))){throw new Error("The rule is an object or it is not a function.")}switch(typeOf(e)){case"object":this._rules[d]=e.invoke;break;case"function":this._rules[d]=e;break}}};var a={currentWatched:function(e,d){return(e==null)},positionChanged:function(e,d){if(e==null){return false}return !(e.getLatitude()==d.getLatitude()&&e.getLongitude()==d.getLongitude())},latitudeChanged:function(e,d){if(e==null){return false}return e.getLatitude()!=d.getLatitude()},longitudeChanged:function(e,d){if(e==null){return false}return e.getLongitude()!=d.getLongitude()},altitudeChanged:function(e,d){if(e==null){return false}return e.getAltitude()!=d.getAltitude()},accuracyChanged:function(e,d){if(e==null){return false}return e.getAccuracy()!=d.getAccuracy()},altitudeAccuracyChanged:function(e,d){if(e==null){return false}return e.getAltitudeAccuracy()!=d.getAltitudeAccuracy()},headingChanged:function(e,d){if(e==null){return false}return e.getHeading()!=d.getHeading()},speedChanged:function(e,d){if(e==null){return false}return e.getSpeed()!=d.getSpeed()}};for(key in a){b.define(key,a[key])}}(Locater));(function(c){var b=c.Handler={create:function(e,d){if(!this[e]){throw new Error("It tries to make an invalid handler.")}return new this[e](d)},isHandler:function(f){var e="Application";var d=(Type.isFunction(f["set"+e])&&Type.isFunction(f["get"+e]));return d}};function a(f){var d=["start","stop","isWatching"];var e={};d.each(function(g){e[g]=Function.from(f[g]).bind(f)});return e}b.Handler=new Class({setApplication:function(d){this._app=a(d)},getApplication:function(){return this._app}});b.SimpleHandler=function(d){return Object.merge(this,d)};b.SimpleHandler.implement(new b.Handler())}(Locater));(function(b,a){b.Dispacher=new Class({_handlers:[],addHandler:function(c){if(!a.isHandler(c)){throw new Error("It is not a handler.")}this._handlers.push(c);return this},addHandlers:function(d){var c=this;d.each(function(e){c.addHandler(e)});return this},removeHandler:function(c){if(!this.hasHandler(c)){return this}this._handlers.erase(c);return this},removeHandlers:function(d){var c=this;d.each(function(e){c.removeHandler(e)});return this},hasHandler:function(c){return this._handlers.contains(c)},dispatch:function(c,d){this._handlers.each(function(e){if(Type.isFunction(e[c])){e[c].apply(e,[d])}})}})}(Locater,Locater.Handler));(function(c){var a={latitude:0,longitude:0,altitude:0,accuracy:0,altitudeAccuracy:0,heading:0,speed:0};function b(f){var g=f.charAt(0).toUpperCase();var e=f.substr(1,f.length);var d="get"+g+e;return d}c.Context=function(g){var i={};var h=Object.keys(a);var f=Object.subset(g,h);Object.each(a,function(k,j){i[j]=f[j]||k});for(var e in i){var d=b(e);this[d]=Function.from(i[e])}return this};c.Context.implement({toString:function(){var g=[];for(var e in a){var d=b(e);var f=this[d]();if(Type.isObject(f)){if(Type.isFunction(f.toString)){f=f.toString()}else{continue}}g.push(e+"="+f)}return g.join(" ")}})}(Locater.Handler));(function(b,a){b.Application=new Class({Implements:[Options],options:{},_adapter:null,_dispacher:null,initialize:function(c,d){if(!(Type.isFunction(c.start)&&Type.isFunction(c.stop))){throw new Error("It is not an adaptor.")}this.setOptions(d);this._adapter=c;this._adapter.setOptions({watchHandler:this.onWatchSuccess.bind(this),errorHandler:this.onError.bind(this)});this._dispacher=new b.Dispacher()},addHandler:function(c){if(!a.isHandler(c)){throw new Error("It is not a handler.")}c.setApplication(this);this._dispacher.addHandler(c);return this},addHandlers:function(d){var c=this;d.each(function(f,e){c.addHandler(f)});return this},removeHandler:function(c){this._dispacher.removeHandler(c);return this},removeHandlers:function(c){this._dispacher.removeHandlers(c);return this},onWatchSuccess:function(c){var e=new b.Handler.Context(c.coords);var d=this;var f=b.Rules.getRules();Object.each(f,function(h,g){if(h.apply(h,[d.context,e])){d._dispacher.dispatch(g,e)}});this.context=e},onError:function(c){this._dispacher.dispatch("error",c)},run:function(){if(this.isWatching()){return}try{this._adapter.start()}catch(c){this._dispacher.dispatch("error",c)}this._dispacher.dispatch("start")},isWatching:function(){return this._adapter.isWatching()},start:function(){this.run()},stop:function(){if(!this.isWatching()){return}this._adapter.stop();this._dispacher.dispatch("stop")}})}(Locater,Locater.Handler));(function(b){var a=b.Emulator=new Class({options:{},_getWatchID:function(){return this._watchID}.protect(),_setWatchID:function(c){this._watchID=c}.protect(),isWatching:function(){return(this._getWatchID()!=null)}})}(Locater));(function(a){a.CurrentPositionEmulator=new Class({Implements:[a,Options],options:{watchHandler:null,errorHandler:null,position:null},_position:null,initialize:function(c){this.setOptions(c);var b=Object.subset(this.options,["position"]);Object.each(b,function(e,d){if(e==null||e==undefined){return}this["set"+d.capitalize()](e);delete this.options[d]},this)},setPosition:function(b){if(!(Type.isObject(b)||b instanceof Error)){throw new TypeError("Please specify an Error object as position from an object.")}this._position=b;return this},getPosition:function(){return this._position},start:function(){var c=this.options;var b=this.getPosition();if(!b){throw new TypeError("Please specify coordinates information for the verification or the error object.")}else{if(b instanceof Error){c.errorHandler(b)}else{if(Type.isObject(b)){c.watchHandler(b)}}}this._setWatchID(new Date().toString())},stop:function(){this._setWatchID(null)}})}(Locater.Emulator));